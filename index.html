<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Information Collector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 900px;
            width: 100%;
        }

        .login-container {
            padding: 30px;
            text-align: center;
        }

        .login-container h2 {
            color: #333;
            margin-bottom: 25px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .tab-container {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #e0e0e0;
        }

        .tab-button.active {
            background: white;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h2 {
            color: #333;
            margin-bottom: 25px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .required::after {
            content: " *";
            color: red;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #c0c0c0;
        }

        .success-message {
            display: none;
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            animation: slideDown 0.3s ease;
        }

        .error-message {
            display: none;
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 3px;
            color: #333;
        }

        .info-box p {
            margin: 5px 0;
            font-size: 14px;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .preview-table th,
        .preview-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .preview-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .preview-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .admin-badge {
            display: inline-block;
            background: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            margin-left: 10px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Admin Login Screen -->
        <div id="loginScreen" class="login-container">
            <h2>Admin Login</h2>
            <div class="info-box">
                <p><strong>Admins Only:</strong> Enter your password to access admin settings.</p>
            </div>
            <div id="loginError" class="error-message"></div>
            <form id="loginForm" onsubmit="handleAdminLogin(event)">
                <div class="form-group">
                    <label for="adminPassword" class="required">Admin Password</label>
                    <input type="password" id="adminPassword" name="adminPassword" placeholder="Enter admin password" required>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn-primary">Login as Admin</button>
                </div>
            </form>
            <p style="margin-top: 20px; color: #999; font-size: 14px;">
                If you're a customer, scroll down to fill out the customer form instead.
            </p>
            <hr style="margin: 30px 0;">
            <h3 style="color: #333; margin-bottom: 20px;">Customer Information Form</h3>
        </div>

        <!-- Main Content (Hidden until admin logs in or customer accesses) -->
        <div id="mainContent" style="display: none;">
            <div class="logout-btn">
                <button type="button" class="btn-secondary" onclick="handleLogout()" style="padding: 8px 15px; font-size: 13px;">Logout Admin</button>
            </div>

            <div class="tab-container">
                <button class="tab-button active" onclick="switchTab('admin')"><span class="admin-badge">ADMIN</span> Settings</button>
                <button class="tab-button" onclick="switchTab('customer')">Customer Form</button>
                <button class="tab-button" onclick="switchTab('preview')">Preview</button>
            </div>

            <!-- Admin Settings Tab -->
            <div id="admin" class="tab-content active">
                <h2>Admin Settings - Configure Customer Data</h2>
                <div id="adminSaveSuccess" class="success-message">
                    Admin settings saved successfully!
                </div>
                <div class="info-box">
                    <p><strong>Instructions:</strong> Fill in the fields below to configure settings for your customer. These values will be saved and pre-populated in the customer form.</p>
                </div>

                <form id="adminForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="domain" class="required">Domain</label>
                            <input type="text" id="domain" name="domain" placeholder="e.g., example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="adminTimezone" class="required">Timezone</label>
                            <input type="text" id="adminTimezone" name="adminTimezone" placeholder="e.g., EST, PST" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="callerIdNumber" class="required">Caller ID Number</label>
                            <input type="text" id="callerIdNumber" name="callerIdNumber" placeholder="e.g., +1234567890" required>
                        </div>
                        <div class="form-group">
                            <label for="callerIdName" class="required">Caller ID Name</label>
                            <input type="text" id="callerIdName" name="callerIdName" placeholder="e.g., Company Name" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="nineOneOneCallerid" class="required">911 Caller ID</label>
                            <input type="text" id="nineOneOneCallerid" name="nineOneOneCallerid" placeholder="e.g., +1234567890" required>
                        </div>
                        <div class="form-group">
                            <label for="dialPlan" class="required">Dial Plan</label>
                            <input type="text" id="dialPlan" name="dialPlan" placeholder="Leave empty to use domain" required>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-secondary" onclick="clearAdminForm()">Clear</button>
                        <button type="button" class="btn-primary" onclick="saveAdminSettings()">Save Settings</button>
                    </div>
                </form>
            </div>

            <!-- Customer Form Tab -->
            <div id="customer" class="tab-content">
                <h2>Customer Information</h2>
                <div id="successMessage" class="success-message">
                    CSV file has been downloaded successfully!
                </div>
                <div class="info-box">
                    <p><strong>Instructions:</strong> Please fill in all the fields marked with an asterisk (*). Your login will be automatically generated from your extension and domain.</p>
                </div>

                <form id="customerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="extension" class="required">Current Extension</label>
                            <input type="text" id="extension" name="extension" placeholder="e.g., 100" required>
                        </div>
                        <div class="form-group">
                            <label for="firstName" class="required">First Name</label>
                            <input type="text" id="firstName" name="firstName" placeholder="e.g., John" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="lastName" class="required">Last Name</label>
                            <input type="text" id="lastName" name="lastName" placeholder="e.g., Doe" required>
                        </div>
                        <div class="form-group">
                            <label for="emailAddress" class="required">Email Address</label>
                            <input type="email" id="emailAddress" name="emailAddress" placeholder="e.g., john.doe@example.com" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="voicemailPin" class="required">Voicemail PIN</label>
                            <input type="password" id="voicemailPin" name="voicemailPin" placeholder="Enter voicemail PIN" required>
                        </div>
                        <div class="form-group">
                            <label for="portalPassword" class="required">Portal Password</label>
                            <input type="password" id="portalPassword" name="portalPassword" placeholder="Enter portal password" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="department">Department</label>
                            <input type="text" id="department" name="department" placeholder="e.g., Sales, Support">
                        </div>
                        <div class="form-group">
                            <label for="site">Site</label>
                            <input type="text" id="site" name="site" placeholder="e.g., Main Office, Remote">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerTimezone" class="required">Timezone</label>
                            <input type="text" id="customerTimezone" name="customerTimezone" placeholder="e.g., EST, PST" required>
                        </div>
                        <div class="form-group">
                            <label for="areaCode" class="required">Area Code</label>
                            <input type="text" id="areaCode" name="areaCode" placeholder="e.g., 555" required>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-secondary" onclick="clearCustomerForm()">Clear</button>
                        <button type="submit" class="btn-primary">Export to CSV</button>
                    </div>
                </form>
            </div>

            <!-- Preview Tab -->
            <div id="preview" class="tab-content">
                <h2>CSV Data Preview</h2>
                <div class="info-box">
                    <p><strong>Note:</strong> Fill in the admin settings first, then the customer form to see a preview of the CSV data that will be exported.</p>
                </div>
                <div id="previewContent" style="margin-top: 20px;">
                    <p style="color: #999; text-align: center;">Fill in the forms above to see preview</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Config - Change this to your desired admin password
        const ADMIN_PASSWORD = "admin123";

        // Default values
        const DEFAULT_VALUES = {
            vmailEnabled: 'yes',
            answerTimeout: 25,
            dialPermission: 'Permit all',
            audioDirectory: 'yes',
            visualDirectory: 'yes',
            vmailTranscribe: 'no',
            emailVmail: 'attnew',
            addPhoneExtension: 'yes',
            scope: 'Basic user'
        };

        let adminSettings = {};
        let isAdminLoggedIn = false;

        // Initialize on page load
        window.addEventListener('load', function() {
            loadAdminSettings();
            checkAdminSession();
        });

        // Check if admin is already logged in (in session storage)
        function checkAdminSession() {
            const adminSession = sessionStorage.getItem('adminLoggedIn');
            if (adminSession === 'true') {
                showMainContent();
            } else {
                showLoginScreen();
            }
        }

        // Handle admin login
        function handleAdminLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                isAdminLoggedIn = true;
                showMainContent();
            } else {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = 'Incorrect password. Please try again.';
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
                document.getElementById('adminPassword').value = '';
            }
        }

        // Handle logout
        function handleLogout() {
            sessionStorage.removeItem('adminLoggedIn');
            isAdminLoggedIn = false;
            document.getElementById('loginForm').reset();
            showLoginScreen();
        }

        // Show main content after login
        function showMainContent() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            loadAdminSettings();
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'preview') {
                updatePreview();
            }
        }

        // Save admin settings
        function saveAdminSettings() {
            const domain = document.getElementById('domain').value.trim();
            const timezone = document.getElementById('adminTimezone').value.trim();
            const callerIdNumber = document.getElementById('callerIdNumber').value.trim();
            const callerIdName = document.getElementById('callerIdName').value.trim();
            const nineOneOneCallerid = document.getElementById('nineOneOneCallerid').value.trim();
            let dialPlan = document.getElementById('dialPlan').value.trim();

            if (!domain || !timezone || !callerIdNumber || !callerIdName || !nineOneOneCallerid) {
                alert('Please fill in all required fields');
                return;
            }

            if (!dialPlan) {
                dialPlan = domain;
            }

            adminSettings = {
                domain,
                timezone,
                callerIdNumber,
                callerIdName,
                nineOneOneCallerid,
                dialPlan
            };

            // Save to localStorage
            localStorage.setItem('adminSettings', JSON.stringify(adminSettings));

            // Show success message
            const successDiv = document.getElementById('adminSaveSuccess');
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // Load admin settings from localStorage
        function loadAdminSettings() {
            const savedSettings = localStorage.getItem('adminSettings');
            if (savedSettings) {
                adminSettings = JSON.parse(savedSettings);
                document.getElementById('domain').value = adminSettings.domain || '';
                document.getElementById('adminTimezone').value = adminSettings.timezone || '';
                document.getElementById('callerIdNumber').value = adminSettings.callerIdNumber || '';
                document.getElementById('callerIdName').value = adminSettings.callerIdName || '';
                document.getElementById('nineOneOneCallerid').value = adminSettings.nineOneOneCallerid || '';
                document.getElementById('dialPlan').value = adminSettings.dialPlan || '';
            }
        }

        // Clear admin form
        function clearAdminForm() {
            document.getElementById('adminForm').reset();
        }

        // Clear customer form
        function clearCustomerForm() {
            document.getElementById('customerForm').reset();
        }

        // Handle customer form submission
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (Object.keys(adminSettings).length === 0) {
                alert('Admin settings have not been configured yet. Please ask the administrator to set them up.');
                return;
            }

            const extension = document.getElementById('extension').value.trim();
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const emailAddress = document.getElementById('emailAddress').value.trim();
            const voicemailPin = document.getElementById('voicemailPin').value.trim();
            const portalPassword = document.getElementById('portalPassword').value.trim();
            const department = document.getElementById('department').value.trim();
            const site = document.getElementById('site').value.trim();
            const customerTimezone = document.getElementById('customerTimezone').value.trim();
            const areaCode = document.getElementById('areaCode').value.trim();

            if (!extension || !firstName || !lastName || !emailAddress || !voicemailPin || !portalPassword || !customerTimezone || !areaCode) {
                alert('Please fill in all required fields (marked with *)');
                return;
            }

            const login = `${extension}@${adminSettings.domain}`;

            const csvData = [
                extension,
                adminSettings.domain,
                firstName,
                lastName,
                login,
                portalPassword,
                emailAddress,
                voicemailPin,
                department,
                site,
                DEFAULT_VALUES.vmailEnabled,
                DEFAULT_VALUES.answerTimeout,
                customerTimezone,
                areaCode,
                adminSettings.callerIdNumber,
                adminSettings.callerIdName,
                adminSettings.nineOneOneCallerid,
                adminSettings.dialPlan,
                DEFAULT_VALUES.dialPermission,
                DEFAULT_VALUES.audioDirectory,
                DEFAULT_VALUES.visualDirectory,
                DEFAULT_VALUES.vmailTranscribe,
                DEFAULT_VALUES.emailVmail,
                DEFAULT_VALUES.addPhoneExtension,
                DEFAULT_VALUES.scope
            ];

            exportToCSV(csvData, firstName, lastName);

            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);

            this.reset();
        });

        // Export to CSV
        function exportToCSV(data, firstName, lastName) {
            const headers = [
                'extension',
                'domain',
                'first name',
                'last name',
                'login',
                'portal password',
                'email address',
                'voicemail pin',
                'department',
                'site',
                'vmail enabled',
                'answer timeout',
                'timezone',
                'area code',
                'callerid number',
                'callerid name',
                '911 callerid',
                'dial plan',
                'dial permission',
                'audio directory',
                'visual directory',
                'vmail_transcribe',
                'email_vmail',
                'add phone extension',
                'scope'
            ];

            const csvContent = [
                headers.join(','),
                data.join(',')
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `customer_info_${firstName}_${lastName}_${timestamp}.csv`;

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Update preview
        function updatePreview() {
            if (Object.keys(adminSettings).length === 0) {
                document.getElementById('previewContent').innerHTML = '<p style="color: #999; text-align: center;">Admin settings not configured yet</p>';
                return;
            }

            const extension = document.getElementById('extension').value.trim();
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const emailAddress = document.getElementById('emailAddress').value.trim();
            const voicemailPin = document.getElementById('voicemailPin').value.trim();
            const portalPassword = document.getElementById('portalPassword').value.trim();
            const department = document.getElementById('department').value.trim();
            const site = document.getElementById('site').value.trim();
            const customerTimezone = document.getElementById('customerTimezone').value.trim();
            const areaCode = document.getElementById('areaCode').value.trim();

            const login = extension && adminSettings.domain ? `${extension}@${adminSettings.domain}` : 'Not set';

            const previewData = {
                'Extension': extension || 'Not set',
                'Domain': adminSettings.domain || 'Not set',
                'First Name': firstName || 'Not set',
                'Last Name': lastName || 'Not set',
                'Login': login,
                'Portal Password': portalPassword ? '••••••••' : 'Not set',
                'Email Address': emailAddress || 'Not set',
                'Voicemail PIN': voicemailPin ? '••••' : 'Not set',
                'Department': department || 'Not set',
                'Site': site || 'Not set',
                'Vmail Enabled': DEFAULT_VALUES.vmailEnabled,
                'Answer Timeout': DEFAULT_VALUES.answerTimeout,
                'Timezone': customerTimezone || 'Not set',
                'Area Code': areaCode || 'Not set',
                'Caller ID Number': adminSettings.callerIdNumber || 'Not set',
                'Caller ID Name': adminSettings.callerIdName || 'Not set',
                '911 Caller ID': adminSettings.nineOneOneCallerid || 'Not set',
                'Dial Plan': adminSettings.dialPlan || 'Not set',
                'Dial Permission': DEFAULT_VALUES.dialPermission,
                'Audio Directory': DEFAULT_VALUES.audioDirectory,
                'Visual Directory': DEFAULT_VALUES.visualDirectory,
                'Vmail Transcribe': DEFAULT_VALUES.vmailTranscribe,
                'Email Vmail': DEFAULT_VALUES.emailVmail,
                'Add Phone Extension': DEFAULT_VALUES.addPhoneExtension,
                'Scope': DEFAULT_VALUES.scope
            };

            let html = '<table class="preview-table"><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>';
            for (const [key, value] of Object.entries(previewData)) {
                html += `<tr><td>${key}</td><td>${value}</td></tr>`;
            }
            html += '</tbody></table>';

            document.getElementById('previewContent').innerHTML = html;
        }
    </script>
</body>
</html>
